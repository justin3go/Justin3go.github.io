<!DOCTYPE html>
<html lang="zh-CH">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Django进阶学习笔记 | Justin3go's Blog-🖊</title>
    <meta name="description" content="我的技术博客，用心记录知识碎片，汇总整理程序员知识。">
    <link rel="stylesheet" href="/assets/style.8a11ac97.css">
    <link rel="modulepreload" href="/assets/Home.fc8ba9e3.js">
    <link rel="modulepreload" href="/assets/app.0b1f5e83.js">
    <link rel="modulepreload" href="/assets/知识库_后端储备_Django进阶学习笔记.md.ea44ee8c.lean.js">
    
    <link rel="icon" href="/ava.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-alpha/dist/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
  <meta name="twitter:title" content="Django进阶学习笔记 | Justin3go&#39;s Blog-🖊">
  <meta property="og:title" content="Django进阶学习笔记 | Justin3go&#39;s Blog-🖊">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Justin3go&#39;s Blog-🖊, back to home" data-v-675d8756 data-v-cc01ef16><!----> Justin3go&#39;s Blog-🖊</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/知识库/" data-v-b8818f8c>知识库 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/推荐/" data-v-b8818f8c>站长推荐 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://space.bilibili.com/434542518" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>B站 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/Justin3go" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/知识库/" data-v-b8818f8c>知识库 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/推荐/" data-v-b8818f8c>站长推荐 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://space.bilibili.com/434542518" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>B站 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/Justin3go" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/">算法与数据结构</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/01基础概念">基础概念</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/02线性表">线性表</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/03栈和队列">栈和队列</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/04数组">数组</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/05树">树</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/06图">图</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/07查找">查找</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/08排序">排序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/09散列表实现查找">散列表实现查找</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/10算法概述">算法概述</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/11递归与分治">递归与分治</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/12动态规划">动态规划</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/13贪心算法">贪心算法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/14回溯与分支极限">回溯与分支极限</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/计算机基础知识/">计算机基础知识</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/计算机基础知识/操作系统基础">操作系统基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/计算机基础知识/操作系统内存分配模拟程序">操作系统内存分配模拟程序</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/JavaScript/">JavaScript</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/JavaScript/这道题原来可以用到JS这么多知识点！">这道题原来可以用到JS这么多知识点！</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/JavaScript/TypeScript">TypeScript</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/CSS相关/">CSS相关</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/CSS相关/01都2022年了，还是得学圣杯布局与双飞翼布局">圣杯布局与双飞翼布局</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/">前端框架</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/01Vue3是如何运行的">Vue3是如何运行的</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/02Vue3编译器">Vue3编译器</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/03虚拟DOM">虚拟DOM</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/04Vue3-Reactivity">Vue3-Reactivity</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/05Mini-Vue">Mini-Vue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/06Vue3其他">Vue3其他</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/UI组件库/">UI组件库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/数据相关/">数据相关</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/后端储备/">后端储备</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/知识库/后端储备/Django进阶学习笔记">Django进阶学习笔记</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#admin">admin</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#注册自定义模型类">注册自定义模型类</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#模型管理器类">模型管理器类</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#orm查询系统">ORM查询系统</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#cookies与session">Cookies与Session</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#cookies特点">cookies特点</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#存储">存储</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#删除">删除</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#获取">获取</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#session">Session</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置">配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用">使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#字段配置项">字段配置项</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#问题">问题</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#返回csv文件与分页">返回CSV文件与分页</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#返回csv文件下载">返回csv文件下载</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#分页">分页</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#例子">例子</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#内建用户系统">内建用户系统</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#中间件">中间件</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#中间件的定义">中间件的定义</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#编写中间件">编写中间件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#注册中间件">注册中间件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#其他（实现限制访问者ip与服务器的请求次数）：">其他（实现限制访问者IP与服务器的请求次数）：</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#csrf-跨站伪造请求攻击">CSRF-跨站伪造请求攻击</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#csrf防范">CSRF防范</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#局部关闭csrf保护">局部关闭csrf保护</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#文件上传">文件上传</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#上传规范-前端-html">上传规范-前端[HTML]</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#上传规范-后端-django">上传规范-后端[Django]</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#文件写入">文件写入</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#邮件">邮件</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#邮件相关协议-smtp">邮件相关协议-SMTP</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#邮件相关协议imap">邮件相关协议IMAP</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#邮件相关协议pop3">邮件相关协议POP3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#对比">对比</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#django发邮件">Django发邮件</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#缓存">缓存</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#缓存-1">缓存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#django中设置缓存-数据库缓存">Django中设置缓存-数据库缓存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#django中设置缓存-本地内存缓存">Django中设置缓存-本地内存缓存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#django中使用缓存-视图函数中">Django中使用缓存-视图函数中</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#django中使用缓存-路由中">Django中使用缓存-路由中</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#缓存api的使用-局部缓存">缓存API的使用(局部缓存)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#浏览器缓存策略">浏览器缓存策略</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/后端储备/DRF学习笔记">DRF学习笔记</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/后端储备/Redis学习笔记">Redis学习笔记</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/AI相关/">AI相关</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/AI相关/TFIDF计算的学习">TFIDF计算的学习</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="django进阶学习笔记" tabindex="-1">Django进阶学习笔记 <a class="header-anchor" href="#django进阶学习笔记" aria-hidden="true">#</a></h1><h2 id="admin" tabindex="-1">admin <a class="header-anchor" href="#admin" aria-hidden="true">#</a></h2><h3 id="注册自定义模型类" tabindex="-1">注册自定义模型类 <a class="header-anchor" href="#注册自定义模型类" aria-hidden="true">#</a></h3><blockquote><p>若要自己定义地模型类也能在/admin后台管理界面中显示和管理，需要将自己的类注册到后台哦管理界面</p></blockquote><div class="language-python"><pre><code><span class="token comment"># admin.py</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Book
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>自定义模型类<span class="token punctuation">)</span>
</code></pre></div><p>模型类的名字是你定义模型的__str__返回值</p><h3 id="模型管理器类" tabindex="-1">模型管理器类 <a class="header-anchor" href="#模型管理器类" aria-hidden="true">#</a></h3><p>作用：为后台管理界面添加便于操作的新功能</p><p>说明：后台管理器类须继承自django.contrib.admin里面的ModelAdmin类</p><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token class-name">XXXManager</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&#39;&#39;&#39;&#39;&#39;&#39;</span>
    <span class="token keyword">pass</span>

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>YYY<span class="token punctuation">,</span> XXXManager<span class="token punctuation">)</span>  <span class="token comment"># 绑定YYY模型</span>
<span class="token comment"># 1.这里也注册了模型类</span>
<span class="token comment"># 2.绑定了管理类</span>
</code></pre></div><p>字段：</p><ul><li><p>list_display = [&#39;id&#39;, &#39;title&#39;, &#39;content&#39;, ......] : 作用是把该域内的字段也显示在管理界面中，否则管理界面中就只会显示模型的类名</p><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/image-20211101215931433-16357751922101.png" alt="image-20211101215931433"></p><blockquote><p>verpose_name就是控制这上面的字段名的</p></blockquote></li><li><p>list_display_links = [&#39;title&#39;] : 作用就是把超链接放在你指定的字段名上，这里造成的变化就是把上面id列的蓝色转移到书名列使其变为蓝色</p></li><li><p>list_filter = [&#39;pub&#39;] : 作用就是对某个字段进行过滤显示的作用</p></li><li><p>search_fields = [&#39;title&#39;] : 以某个字段添加搜索框，模糊查询</p></li><li><p>list_editable = [&#39;price&#39;] : 添加可在列表编辑的字段</p></li></ul><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/image-20211101220946145.png" alt="image-20211101220946145" style="zoom:50%;"><h2 id="orm查询系统" tabindex="-1">ORM查询系统 <a class="header-anchor" href="#orm查询系统" aria-hidden="true">#</a></h2><ul><li><p>all()</p></li><li><p>values(&#39;列1&#39;, ‘列2’)</p><p>查询部分列的数据返回</p></li><li><p>filter()</p><ul><li><div class="language-python"><pre><code>MyModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>属性<span class="token number">1</span><span class="token operator">=</span>值<span class="token number">1</span><span class="token punctuation">,</span> 属性<span class="token number">2</span><span class="token operator">=</span>只<span class="token punctuation">)</span>
</code></pre></div></li><li><p>作用：返回包含此条件的全部数据集</p></li><li><p>当多个属性在一起时默认为&#39;与&#39;关系</p></li></ul></li><li><p>exclude(): 不包含</p></li><li><p>条件查询--查询谓词</p><ul><li><p>__exact：等值匹配，一般不加，默认就为这个，匹配null时会加</p></li><li><p>__contains：包含指定值</p></li><li><p>__startswith:</p></li><li><p>__endswith:</p></li><li><p>__gt：大于</p></li><li><p>__gte：大于等于</p></li><li><p>__lt：小于</p></li><li><p>__lte：小于等于</p></li><li><p>__in：查找数据是否在指定范围内</p><div class="language-python"><pre><code>Auther<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>country__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;中国&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;日本&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;韩国&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>__range：查找数据是否在指定的区间范围内</p><div class="language-python"><pre><code>Auther<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li><li><p>F对象</p><ul><li><p>一个F对象代表数据库中某条记录的字段的信息</p></li><li><p>通常是对数据库中的字段值在不获取的情况下进行操作用于类属性之间的比较</p></li><li><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">,</span>models <span class="token keyword">import</span> F
F<span class="token punctuation">(</span><span class="token string">&#39;列名&#39;</span><span class="token punctuation">)</span>
</code></pre></div></li><li><div class="language-python"><pre><code><span class="token comment"># 示例：更新Book实例中所有的零售价涨10元</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>market_price<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">&#39;market_pice&#39;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># 以上做法好于如下代码</span>
books <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> book <span class="token keyword">in</span> books<span class="token punctuation">:</span>
    book<span class="token punctuation">.</span>market_price<span class="token operator">=</span>book<span class="token punctuation">.</span>marget_price<span class="token operator">+</span><span class="token number">10</span>
    book<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>上面的做法相当于+=10,而下面的做法就是把这个值实实在在地查出来之后加上10，再把这个最终的值放进去</p><p><strong>解决并发计数的问题</strong></p><p>比如点赞数的更新就必须是F对象操作，而不能将数据库中的值取出来，否则可能造成多端不同步的情况</p></li></ul></li><li><p>Q对象</p><ul><li><p>当在获取查询结果集，使用复杂的逻辑或、逻辑非，与非(~&amp;)等操作时可以借助Q对象进行操作</p></li><li><p>如：想找出定价低于20元或清华大学出版社的全部书，可以写成</p><div class="language-python"><pre><code>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Q<span class="token punctuation">(</span>price__lt<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">|</span>Q<span class="token punctuation">(</span>pub<span class="token operator">=</span><span class="token string">&quot;清华大学出版社&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li><li><p>聚合函数</p><ul><li><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
</code></pre></div></li><li><p>Sum, Avg, Count, Max, Min</p></li><li><div class="language-python"><pre><code>MyModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>agregate<span class="token punctuation">(</span>结果变量名<span class="token operator">=</span>聚合函数<span class="token punctuation">(</span><span class="token string">&#39;列&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&quot;结果变量名&quot;</span><span class="token punctuation">:</span> 值<span class="token punctuation">}</span>
</code></pre></div></li><li><p>在后面加filter就等于having</p></li></ul></li><li><p>原生数据库操作</p><div class="language-python"><pre><code>Mymodel<span class="token punctuation">.</span>bjects<span class="token punctuation">.</span>raw<span class="token punctuation">(</span>sql语句<span class="token punctuation">,</span> 拼接参数<span class="token punctuation">)</span>
books <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>raw<span class="token punctuation">(</span><span class="token string">&#39;select * from bookstore_book&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>使用原生数据库操作时需要小心SQL注入</p><p>定义：用户通过数据上传，将恶意的sql语句提交给服务器，从而达到攻击效果</p><p>案例1：用户在搜索好友的表单框里输入‘1 or 1=1’</p><div class="language-python"><pre><code>s1 <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>raw<span class="token punctuation">(</span><span class="token string">&#39;select * from bookstore_book where id=%s&#39;</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token string">&#39;1 or 1=1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>攻击结果：查询出所有用户</p><p>解决办法：使用拼接参数</p><p>cursor</p></li></ul><h2 id="cookies与session" tabindex="-1">Cookies与Session <a class="header-anchor" href="#cookies与session" aria-hidden="true">#</a></h2><h3 id="cookies特点" tabindex="-1">cookies特点 <a class="header-anchor" href="#cookies特点" aria-hidden="true">#</a></h3><ul><li>cookies在浏览器上是以键值对的形式进行存储的，键和值都是以ASCII字符串的形式存储（不能是中文字符）</li><li>存储的数据带有生命周期</li><li>cookies中的数据是按域存储隔离的，不同的域之间无法访问</li><li>cookies内部的数据会在每次访问此网址时都会携带到服务器端，如果cookies过大会降低响应速度</li></ul><h3 id="存储" tabindex="-1">存储 <a class="header-anchor" href="#存储" aria-hidden="true">#</a></h3><div class="language-python"><pre><code>HttpResponse<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> expire<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&#39;&#39;&#39;
key: cookies的名字
value: 值
max_age: 存活时间，秒为单位
expires: 具体过期时间
注：当不指定后两个参数的时候，关闭浏览器时此数据失效
&#39;&#39;&#39;</span>
</code></pre></div><h3 id="删除" tabindex="-1">删除 <a class="header-anchor" href="#删除" aria-hidden="true">#</a></h3><div class="language-python"><pre><code>HttpResponse<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
<span class="token comment"># 删除指定key的cookie,如果key不存在则什么也不发生</span>
</code></pre></div><h3 id="获取" tabindex="-1">获取 <a class="header-anchor" href="#获取" aria-hidden="true">#</a></h3><div class="language-python"><pre><code>value <span class="token operator">=</span> request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;cookies名&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;默认值&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># 其中request.COOKIES返回的时字典</span>
</code></pre></div><h3 id="session" tabindex="-1">Session <a class="header-anchor" href="#session" aria-hidden="true">#</a></h3><p>原因：数据都存在了浏览器端，每次请求都要传一大堆，同时也不安全</p><p>解决：浏览器端仅仅保存一段身份验证码，其他的数据全部存在服务器端</p><p>session是在服务器上开辟的一段空间用于保留浏览器和服务器交互时的重要数据</p><p>实现方式：</p><ul><li>使用sesion需要在浏览器客户端启动cooke，且在cookie中存储sessionId</li><li>每个客户端都可以在服务器端有一个独立的session</li><li>注意：不同的请求者之间不会共享这个数据，与请求者一一对应</li></ul><h3 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token comment"># 默认是开启的</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># 启动 sessions 应用</span>
    <span class="token string">&#39;django.contrib.sessions&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-hidden="true">#</a></h3><p>和字典一样</p><ul><li><p>保存session的值到服务器</p><div class="language-python"><pre><code>request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;KEY&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> VALUE
</code></pre></div></li><li><p>获取session的值</p><div class="language-python"><pre><code>value <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;KEY&#39;</span><span class="token punctuation">]</span>
value <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;KEY&#39;</span><span class="token punctuation">,</span>默认值<span class="token punctuation">]</span>
</code></pre></div></li><li><p>删除session</p><div class="language-python"><pre><code><span class="token keyword">del</span> request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;KEY&#39;</span><span class="token punctuation">]</span>
</code></pre></div></li></ul><h3 id="字段配置项" tabindex="-1">字段配置项 <a class="header-anchor" href="#字段配置项" aria-hidden="true">#</a></h3><div class="language-python"><pre><code>SESSION_COOKIE_AGE <span class="token operator">=</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">2</span>
<span class="token comment"># 指定sessionid在cookies中的保存时长（默认是两周）</span>
SESSION_EXPIRE_AT_BROWSER_CLOSE <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token comment"># 设置在关闭浏览器时，session就失效</span>
</code></pre></div><h3 id="问题" tabindex="-1">问题 <a class="header-anchor" href="#问题" aria-hidden="true">#</a></h3><ul><li>django_session表是单表设计；且该表数据量持续增持【浏览器故意删掉sessionid&amp;过期数据未删除】</li><li>可以每晚执行python3 <a href="http://manage.py" target="_blank" rel="noopener noreferrer">manage.py</a> clearsessions【删除已过期的session数据】</li></ul><h2 id="返回csv文件与分页" tabindex="-1">返回CSV文件与分页 <a class="header-anchor" href="#返回csv文件与分页" aria-hidden="true">#</a></h2><h3 id="返回csv文件下载" tabindex="-1">返回csv文件下载 <a class="header-anchor" href="#返回csv文件下载" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token keyword">import</span> csv
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;eggs.csv&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerrow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>在网站中，要实现下载csv文件，<strong>需注意</strong>：</p><ul><li>响应Content-Type类型需修改为text/csv。着告诉浏览器是csv文件，而不是HTML文件</li><li>响应会获得额外的Content-Disposition标头，其中包含CSV文件的名称。它将被浏览器用于开启’另存为‘对话框</li></ul><div class="language-python"><pre><code><span class="token keyword">import</span> csv
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse

<span class="token keyword">def</span> <span class="token function">some_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Create the HttpResponse object with the appropriate CSV header.</span>
    response <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span>
        content_type<span class="token operator">=</span><span class="token string">&#39;text/csv&#39;</span><span class="token punctuation">,</span>
        headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;Content-Disposition&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;attachment; filename=&quot;somefilename.csv&quot;&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;First row&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Foo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Bar&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Baz&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;Second row&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;B&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;C&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&quot;Testing&quot;&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;Here&#39;s a quote&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> response
</code></pre></div><h3 id="分页" tabindex="-1">分页 <a class="header-anchor" href="#分页" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token keyword">class</span> <span class="token class-name">Paginator</span><span class="token punctuation">(</span>object_list<span class="token punctuation">,</span> per_page<span class="token punctuation">,</span> orphans<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> allow_empty_first_page<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&#39;&#39;&#39;
Paginator.object_list
必要的。一个列表、元组、QuerySet 或其他具有 count() 或 __len__() 方法的可切片对象。为了实现一致的分页，QuerySet 应该是有序的，例如使用 order_by() 子句或使用模型上的默认 ordering。

对大型 QuerySet 进行分页的性能问题

如果你使用的 QuerySet 有非常多的项目，在某些数据库上请求高页数可能会很慢，因为产生的 LIMIT ／ OFFSET 查询需要计算 OFFSET 记录的数量，随着页数的增加，需要的时间也就越长。

Paginator.per_page
必要的。一个页面中包含的最大项目数，不包括 orphans（参见下面的 orphans 可选参数）。

Paginator.orphans
可选的。当你不希望最后一页的项目数量很少时，使用这个选项。如果最后一页的项目数量通常小于或等于 orphans，那么这些项目将被添加到前一页（成为最后一页），而不是让这些项目单独留在一页上。例如，如果有 23 个条目，per_page=10，orphans=3，则会有两页；第一页有 10 个条目，第二页（也是最后一页）有 13 个条目。orphans 默认为 0，这意味着页面永远不会合并，最后一页可能只有一个项目。

Paginator.allow_empty_first_page
可选的。是否允许第一页为空。 如果 False 并且 object_list 是空的，则会出现 EmptyPage 错误。
&#39;&#39;&#39;</span>
        
</code></pre></div><h5 id="paginator属性" tabindex="-1">Paginator属性 <a class="header-anchor" href="#paginator属性" aria-hidden="true">#</a></h5><ul><li>Paginator.count：需要分页数据的对象总数</li><li>Paginator.num_pages：分页后的页面总数</li><li>page_range：从1开始的range对象，用于记录当前面码数</li><li>per_page：每页数据的个数</li></ul><h5 id="paginator方法" tabindex="-1">Paginator方法 <a class="header-anchor" href="#paginator方法" aria-hidden="true">#</a></h5><p>Paginator对象.page(number)</p><ul><li>参数number为页码信息(从1开始)</li><li>返回当前number页对应的页信息</li><li>如果提供的页码不存在，抛出InvaildPage异常</li></ul><p>page对象</p><ul><li>创建对象：Paginator对象.page(number)</li><li>属性： <ul><li>object_list：当前页上所有数据对象的列表</li><li>number：当前页的序号，从1开始</li><li>paginator：当前page对象相关的Paginator对象</li></ul></li><li>方法 <ul><li>Page.has_next() 如果有下一页，返回 True。</li><li>Page.has_previous() 如果有上一页，返回 True。</li><li>Page.has_other_pages() 如果有下一页 或 上一页，返回 True。</li><li>Page.next_page_number() 返回下一页的页码。如果下一页不存在，则引发 InvalidPage。</li><li>Page.previous_page_number() 返回上一页的页码。如果上一页不存在，则引发 InvalidPage。</li><li>Page.start_index() 返回页面上第一个对象，相对于分页器列表中所有对象的基于 1 的索引。例如，当对一个有 5 个对象的列表进行分页时，每页有 2 个对象，第二页的 start_index() 将返回 3。</li><li>Page.end_index() 返回页面上最后一个对象相对于分页器列表中所有对象的基于 1 的索引。例如，当对一个有 5 个对象的列表进行分页时，每页有 2 个对象，第二页的 end_index() 将返回 4。</li></ul></li></ul><blockquote><p>paginator掌控全局，page掌控某一页</p></blockquote><h3 id="例子" tabindex="-1">例子 <a class="header-anchor" href="#例子" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token keyword">def</span> <span class="token function">test_page</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#/test_page/4</span>
    <span class="token comment">#/test_page?page=1</span>
    page_num <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;page&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    all_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;d&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;e&#39;</span><span class="token punctuation">]</span>
    <span class="token comment"># 初始化paginator</span>
    paginator <span class="token operator">=</span> Paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>page_num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 初始化具体页码的page对象</span>
    c_page <span class="token operator">=</span> paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;test_page.html&#39;</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-django"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">for</span> <span class="token variable">p</span> <span class="token keyword">in</span> <span class="token variable">c_page</span> <span class="token delimiter punctuation">%}</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    	<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">p</span> <span class="token delimiter punctuation">}}</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
有上一页就为超链，否则为文本
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">if</span> <span class="token variable">c_page</span><span class="token punctuation">.</span><span class="token variable">has_previous</span> <span class="token delimiter punctuation">%}</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/test_page?page=<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">c_page</span><span class="token punctuation">.</span><span class="token variable">previous_page_number</span> <span class="token delimiter punctuation">}}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上一页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">else</span> <span class="token delimiter punctuation">%}</span></span>
	上一页
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%}</span></span>
当前页为文本，其他页为超链
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">for</span> <span class="token variable">p_num</span> <span class="token keyword">in</span> <span class="token variable">paginator</span><span class="token punctuation">.</span><span class="token variable">page_range</span> <span class="token delimiter punctuation">%}</span></span>
	<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">if</span> <span class="token variable">p_num</span> <span class="token operator">==</span> <span class="token variable">c_page</span><span class="token punctuation">.</span><span class="token variable">number</span> <span class="token delimiter punctuation">%}</span></span>
		<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">p_num</span> <span class="token delimiter punctuation">}}</span></span>
	<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">else</span> <span class="token delimiter punctuation">%}</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/test_page?page=<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">p</span> <span class="token delimiter punctuation">}}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">p_num</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span>
同上上
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">if</span> <span class="token variable">c_page</span><span class="token punctuation">.</span><span class="token variable">has_next</span> <span class="token delimiter punctuation">%}</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/test_page?page=<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">c_page</span><span class="token punctuation">.</span><span class="token variable">next_page_number</span> <span class="token delimiter punctuation">}}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上一页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">else</span> <span class="token delimiter punctuation">%}</span></span>
	下一页
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%}</span></span>
</code></pre></div><h2 id="内建用户系统" tabindex="-1">内建用户系统 <a class="header-anchor" href="#内建用户系统" aria-hidden="true">#</a></h2><h4 id="自定义扩展字段的方法" tabindex="-1">自定义扩展字段的方法 <a class="header-anchor" href="#自定义扩展字段的方法" aria-hidden="true">#</a></h4><ul><li><p>建立一个一对一的表扩展User模型</p><p>以后取字段需要查询</p><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    department <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>继承AbstracUser类替换User模型</p><p>仍然可以使用django一套的用户操作</p><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><p>注意：需要在配置文件指定使用自己的用户类</p><div class="language-python"><pre><code>AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">&#39;myapp.MyUser&#39;</span>
</code></pre></div></li><li><p>django建议在项目初期使用替换，项目中期使用一对一</p></li><li><p>此时引用User就应该使用你自定义的User名或者使用get_user_model()方法</p></li></ul><h4 id="默认用户的字段" tabindex="-1">默认用户的字段 <a class="header-anchor" href="#默认用户的字段" aria-hidden="true">#</a></h4><ul><li>username</li><li>password</li><li>email</li><li>first_name</li><li>last_name</li></ul><h4 id="创建用户" tabindex="-1">创建用户 <a class="header-anchor" href="#创建用户" aria-hidden="true">#</a></h4><div class="language-python"><pre><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span><span class="token string">&#39;john&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;lennon@thebeatles.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;johnpassword&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># At this point, user is a User object that has already been saved</span>
<span class="token comment"># to the database. You can continue to change its attributes</span>
<span class="token comment"># if you want to change other fields.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>last_name <span class="token operator">=</span> <span class="token string">&#39;Lennon&#39;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="更改密码" tabindex="-1">更改密码 <a class="header-anchor" href="#更改密码" aria-hidden="true">#</a></h4><p>set_password()</p><blockquote><p>注意不能直接更新数据库中的密码，因为那是非明文操作的</p></blockquote><div class="language-python"><pre><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;john&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span><span class="token string">&#39;new password&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="验证用户" tabindex="-1">验证用户 <a class="header-anchor" href="#验证用户" aria-hidden="true">#</a></h4><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate
user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;john&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;secret&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token comment"># A backend authenticated the credentials</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># No backend authenticated the credentials</span>
</code></pre></div><p>使用 authenticate() 来验证用户。它使用 username 和 password 作为参数来验证，对每个身份验证后端( authentication backend )进行检查。如果后端验证有效，则返回一个 :class:`~django.contrib.auth.models.User 对象。如果后端引发 PermissionDenied 错误，将返回 None</p><h4 id="登录" tabindex="-1">登录 <a class="header-anchor" href="#登录" aria-hidden="true">#</a></h4><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate<span class="token punctuation">,</span> login

<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">]</span>
    user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>request<span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span>
    <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        login<span class="token punctuation">(</span>request<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token comment"># Redirect to a success page.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Return an &#39;invalid login&#39; error message.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h4 id="登出" tabindex="-1">登出 <a class="header-anchor" href="#登出" aria-hidden="true">#</a></h4><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> logout

<span class="token keyword">def</span> <span class="token function">logout_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token comment"># Redirect to a success page.</span>
</code></pre></div><h4 id="限制对未登录用户的访问" tabindex="-1">限制对未登录用户的访问 <a class="header-anchor" href="#限制对未登录用户的访问" aria-hidden="true">#</a></h4><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect

<span class="token comment"># 这里师是重定向到登录界面，并且next保留上一个界面的信息，方便登录后回到之前的界面</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;%s?next=%s&#39;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>settings<span class="token punctuation">.</span>LOGIN_URL<span class="token punctuation">,</span> request<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># ...</span>
</code></pre></div><h4 id="login-required-装饰器" tabindex="-1">login_required 装饰器 <a class="header-anchor" href="#login-required-装饰器" aria-hidden="true">#</a></h4><p>作用：</p><ul><li>如果用户没有登录，会重定向到setting.LOGIN_URL中，并传递绝对路径到查询字符串中</li><li>或者直接写url：@login_required(login_url=&#39;/accounts/login/&#39;)</li></ul><h4 id="限制对通过测试的登录用户的访问" tabindex="-1">限制对通过测试的登录用户的访问 <a class="header-anchor" href="#限制对通过测试的登录用户的访问" aria-hidden="true">#</a></h4><p>你可以方便的调用 <code>user_passes_test</code> 装饰器，当调用返回 <code>False</code> 时会执行重定向。</p><blockquote><p>user_passes_test(test_func, login_url=None, redirect_field_name=&#39;next&#39;)</p><p>redirect_field_name: 与 login_required() 相同。如果你想把没通过检查的用户重定向到没有 &quot;next page&quot; 的非登录页面时，把它设置为 None ，这样它会在 URL 中移除。</p></blockquote><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> user_passes_test

<span class="token keyword">def</span> <span class="token function">email_check</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> user<span class="token punctuation">.</span>email<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">&#39;@example.com&#39;</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@user_passes_test</span><span class="token punctuation">(</span>email_check<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>类的话继承<strong>UserPassesTestMixin</strong> # 其他的装饰器都有对应的MIXIN类，可查阅文档</p><h4 id="permission-required-装饰器" tabindex="-1">permission_required 装饰器 <a class="header-anchor" href="#permission-required-装饰器" aria-hidden="true">#</a></h4><p>permission_required(perm, login_url=None, raise_exception=False)</p><p>permission_required() 也可以接受可选的 login_url 参数——————去看文档</p><h2 id="中间件" tabindex="-1">中间件 <a class="header-anchor" href="#中间件" aria-hidden="true">#</a></h2><h3 id="中间件的定义" tabindex="-1">中间件的定义 <a class="header-anchor" href="#中间件的定义" aria-hidden="true">#</a></h3><ul><li>中间是Django请求/响应处理的钩子框架。它是一个轻量级的低级的“插件”系统，用于全局改变Django的输入或输出。</li><li>中间件以类的形式体现。</li><li>每个中间件组件负责做一些特定的功能。例如，Django包含一个中间组件AuthenticationMiddleware,它使用会话将用户与请求关联起来。</li></ul><h3 id="编写中间件" tabindex="-1">编写中间件 <a class="header-anchor" href="#编写中间件" aria-hidden="true">#</a></h3><blockquote><p>一般是在项目文件夹下面单独建一个middleware文件夹，下面编写middleware.py文件</p></blockquote><ul><li><p>中间件类必须继承自django.utils.deprecation.MiddlewareMixin类</p></li><li><p>中间件类须实现下列五个方法中的一个或多个：</p><ul><li><p>process_request(self, request)</p><p>执行路由前被调用，在每个请求上调用，返回None或HttpRespose对象</p><blockquote><p>返回None就可以往后面走</p><p>返回respose就会拦截该请求</p></blockquote></li><li><p>process_view(self, request, callback, callback_args. callback_kwargs)</p><p>调用视图之前被调用，在每个请求上调用，返回None或HttpResonse对象</p></li><li><p>process_response(self, request, response)</p><p>所有响应返回浏览器被调用，在每个请求上调用，返回HttpResponse对象</p></li><li><p>process_exception(self, request, exception)</p><p>当处理过程中抛出异常时调用，返回一个HttpResponse对象</p></li><li><p>process_template_response(self, request, response)</p><p>在视图函数执行完毕且视图返回的对象中包含render方法时被调用；该方法需要返回实现了render方法的响应对象</p></li></ul><p>注：中间件中的大多数方法返回None时标识忽略当前操作进入下一项事件，当返回HttpResopnse对象时表示此请求结束，直接返回给客户端</p></li></ul><h3 id="注册中间件" tabindex="-1">注册中间件 <a class="header-anchor" href="#注册中间件" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token comment"># settings.py</span>
MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
<span class="token comment"># 执行顺序，从上到下，再从下到上</span>
</code></pre></div><h3 id="其他（实现限制访问者ip与服务器的请求次数）：" tabindex="-1">其他（实现限制访问者IP与服务器的请求次数）： <a class="header-anchor" href="#其他（实现限制访问者ip与服务器的请求次数）：" aria-hidden="true">#</a></h3><p>request.META[&#39;REMOTE_ADDR&#39;]可以得到远程客户端的IP地址</p><p>request.path_info可以得到客户端访问的请求路由信息</p><div class="language-python"><pre><code><span class="token keyword">class</span> <span class="token class-name">VisitLimit</span><span class="token punctuation">(</span>MiddlewareMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    visit_times <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># 这里其实应该放到内存里面redis</span>
    
    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ip_address <span class="token operator">=</span> request<span class="token punctuation">.</span>META<span class="token punctuation">[</span><span class="token string">&#39;REMOTE_ADDR&#39;</span><span class="token punctuation">]</span>
        path_url <span class="token operator">=</span> request<span class="token punctuation">.</span>path_info
        <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">&#39;^/test&#39;</span><span class="token punctuation">,</span> path_yrl<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        times<span class="token operator">=</span> self<span class="token punctuation">.</span>visit_ime<span class="token punctuation">.</span>get<span class="token punctuation">(</span>ip_adress<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;ip&#39;</span><span class="token punctuation">,</span> ip_address<span class="token punctuation">,</span> <span class="token string">&#39;已经访问&#39;</span><span class="token punctuation">,</span> times<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>visit_times<span class="token punctuation">[</span>ip_address<span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">if</span> times <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;您已经访问过&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>times<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;次， 访问被禁止&#39;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="csrf-跨站伪造请求攻击" tabindex="-1">CSRF-跨站伪造请求攻击 <a class="header-anchor" href="#csrf-跨站伪造请求攻击" aria-hidden="true">#</a></h3><p>某些恶意网站上包含连接、表单按钮或者Javascript，它们会利用登录过的用户再浏览器中的认证信息视图再你的网站上完成某些操作，这就是跨站请求伪造（CSRF, 即Cross-Site Request Forgey）</p><p>登录过的网站会将登录状态保存在Cookie里面然后如果没有退出，另一边网站上也会自动提交。</p><h3 id="csrf防范" tabindex="-1">CSRF防范 <a class="header-anchor" href="#csrf防范" aria-hidden="true">#</a></h3><ul><li>django采用’比对暗号‘机制防范攻击</li><li>Cookies中存储暗号1，模板中表单里藏着暗号2，用户只有在本网站下提交数据，暗号2才会随表单提交给服务器django比对两个暗号，对比成功，则认为是合法请求，否则是违法请求-403</li></ul><div class="language-python"><pre><code><span class="token comment"># settings.py中确认中间件中</span>
django<span class="token punctuation">.</span>moiddleware<span class="token punctuation">.</span>csrf<span class="token operator">/</span>csrfViewMiddleware是否打开
<span class="token comment"># form标签下添加如下标签</span>
<span class="token punctuation">{</span><span class="token operator">%</span> csrf_token <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="局部关闭csrf保护" tabindex="-1">局部关闭csrf保护 <a class="header-anchor" href="#局部关闭csrf保护" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt

<span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;He&#39;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="文件上传" tabindex="-1">文件上传 <a class="header-anchor" href="#文件上传" aria-hidden="true">#</a></h2><h3 id="上传规范-前端-html" tabindex="-1">上传规范-前端[HTML] <a class="header-anchor" href="#上传规范-前端-html" aria-hidden="true">#</a></h3><ul><li>POST</li><li>&lt;form&gt;中文件上传时必须带有enctype=&quot;multipart/from-data&quot;时才会包含文件内容数据。</li><li>表单中用&lt;input type=&quot;file&quot; name=&quot;xxx&quot;&gt;标签上传文件</li></ul><div class="language-python"><pre><code><span class="token keyword">def</span> <span class="token function">test_upload</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;test_upload.html&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;--上传文件成功--&quot;</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/test_upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>上传<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="上传规范-后端-django" tabindex="-1">上传规范-后端[Django] <a class="header-anchor" href="#上传规范-后端-django" aria-hidden="true">#</a></h3><p>视图函数中，用request.FILES取文件框的内容</p><div class="language-python"><pre><code><span class="token builtin">file</span><span class="token operator">=</span>request<span class="token punctuation">.</span>FILE<span class="token punctuation">[</span><span class="token string">&#39;XXX&#39;</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">&#39;&#39;&#39;
说明：
1. FILES的key对应页面中file框的name值
2. file绑定文件流对象
3. file.name文件名
4. file.file文件的字节流数据
&#39;&#39;&#39;</span>
</code></pre></div><div class="language-python"><pre><code><span class="token triple-quoted-string string">&#39;&#39;&#39;
配置文件的访问路径和存储路径
在setting.py中设置MEDIA相关配置；Django把用户上传的文件，统称为media资源
Django把用户上传的文件，统称为media资源
&#39;&#39;&#39;</span>
<span class="token comment"># file : settings.py</span>
MEDIA_URL <span class="token operator">=</span> <span class="token string">&#39;/media/&#39;</span>
MWDIA_ROOT <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">&#39;media&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>其中，MEDIA_URL和MEDIA_ROOT需要手动绑定</p><div class="language-python"><pre><code><span class="token comment"># 步骤：主路由中添加路由</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls<span class="token punctuation">.</span>static <span class="token keyword">import</span> static
urlpatterns <span class="token operator">+=</span> static<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_URL<span class="token punctuation">,</span> document_root <span class="token operator">=</span> settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&#39;&#39;&#39;
等价于做了MEDIA_URL开头的路由，Django接到该特征请求后取MEDIA_ROOT路径查找资源
&#39;&#39;&#39;</span>
</code></pre></div><h3 id="文件写入" tabindex="-1">文件写入 <a class="header-anchor" href="#文件写入" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token comment"># 方案1：传统的open方式</span>
<span class="token keyword">def</span> <span class="token function">upload_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;test_upload.html&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span>
        a_file <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">[</span><span class="token string">&#39;myfile&#39;</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上传文件名是：&quot;</span><span class="token punctuation">,</span> a_file<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>setting<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span> a_file<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            data <span class="token operator">=</span> a_file<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;接收文件：&quot;</span> <span class="token operator">+</span> a_file<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 有一些问题，比如文件重名等细节</span>
</code></pre></div><div class="language-python"><pre><code><span class="token comment"># 方案2：借助ORM</span>
<span class="token comment"># 字段：FileField(upload=&#39;子目录名&#39;)</span>

<span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token keyword">def</span> <span class="token function">upload_view_dj</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;test_upload.html&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span>
        title <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span>
        a_file <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">[</span><span class="token string">&#39;myfile&#39;</span><span class="token punctuation">]</span>
        <span class="token comment"># 就这下面一项就可以存</span>
        Content<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>desc<span class="token operator">=</span>title<span class="token punctuation">,</span> myfile<span class="token operator">=</span>a_file<span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;----upload is ok----&#39;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="邮件" tabindex="-1">邮件 <a class="header-anchor" href="#邮件" aria-hidden="true">#</a></h2><h3 id="邮件相关协议-smtp" tabindex="-1">邮件相关协议-SMTP <a class="header-anchor" href="#邮件相关协议-smtp" aria-hidden="true">#</a></h3><ul><li>SMTP的全称是&quot;Simple Mail TransferProtocol&quot;，即简单邮件传输协议（25号端口）</li><li>它是一组用于从源地址到目的地址传输邮件的规范，通过它来控制邮件的中转</li><li><strong>属于”推送“协议</strong></li></ul><h3 id="邮件相关协议imap" tabindex="-1">邮件相关协议IMAP <a class="header-anchor" href="#邮件相关协议imap" aria-hidden="true">#</a></h3><ul><li>IMAP的全称是Internet Mail Access Protocol，即交互式邮件访问协议，是一个应用层协议（端口143）</li><li>用来从本地邮件客户端（outlook, foxmail等）访问远程服务器上的邮件</li><li><strong>属于”拉取“协议</strong></li></ul><h3 id="邮件相关协议pop3" tabindex="-1">邮件相关协议POP3 <a class="header-anchor" href="#邮件相关协议pop3" aria-hidden="true">#</a></h3><ul><li>TCP/IP中的一员(端口110)</li><li>本协议主要用于支持使用客户端远程管理在服务器上的电子邮件</li><li>属于&quot;拉取&quot;协议</li></ul><h3 id="对比" tabindex="-1">对比 <a class="header-anchor" href="#对比" aria-hidden="true">#</a></h3><ul><li><p>IMAP具备摘要浏览功能，可预览部分摘要，再下载整个邮件</p></li><li><p>IMAP为双向协议，客户端操作可反馈给服务器</p></li><li><p>POP3必须下载全部邮件，无摘要功能</p></li><li><p>POP3为单向协议，客户端操作无法同步服务器</p></li></ul><h3 id="django发邮件" tabindex="-1">Django发邮件 <a class="header-anchor" href="#django发邮件" aria-hidden="true">#</a></h3><ul><li>Django中配置邮件功能，主要为SMTP协议，负责发邮件</li><li>原理： <ul><li>给djangp授权一个邮箱</li><li>django用给邮箱给对应发件人发送邮件</li><li>django.core.mail封装了电子邮件的自动发送SMTP协议</li></ul></li></ul><h5 id="配置-1" tabindex="-1">配置 <a class="header-anchor" href="#配置-1" aria-hidden="true">#</a></h5><div class="language-python"><pre><code><span class="token comment"># 先获取SMTP服务的授权码</span>
EMAIL_BACKEND <span class="token operator">=</span> <span class="token string">&#39;django.core.mail.backends.smtp.EmailBackend&#39;</span>
EMAIL_HOST <span class="token operator">=</span> <span class="token string">&#39;SMTP.qq.com&#39;</span>
EMAILPORT <span class="token operator">=</span> <span class="token number">25</span> <span class="token comment"># SMTP服务的端口号</span>
EMAIL_HOST_USER <span class="token operator">=</span> <span class="token string">&#39;xxxx@qq.com&#39;</span> <span class="token comment"># 发送邮件的qq邮箱</span>
EMAIL_HOST_PASSWORD <span class="token operator">=</span> <span class="token string">&#39;******&#39;</span> <span class="token comment"># QQ邮箱-&gt;设置-&gt;账户-&gt;&#39;POP3/IMAP...服务&#39;里面得到的授权码</span>
EMAIL_USE_TLS <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment"># 是否启动TLS链接（安全链接）默认False--比较费时</span>
</code></pre></div><h5 id="调用" tabindex="-1">调用 <a class="header-anchor" href="#调用" aria-hidden="true">#</a></h5><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>core <span class="token keyword">import</span> mail
mail<span class="token punctuation">.</span>send_mail<span class="token punctuation">(</span>
	subject<span class="token punctuation">,</span>  <span class="token comment"># 题目</span>
    message<span class="token punctuation">,</span>  <span class="token comment"># 消息内容</span>
    from_email<span class="token punctuation">,</span>  <span class="token comment"># 发送者[当前配置邮箱]</span>
    recipient_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;xxx@qq.com&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># 接收者邮件列表</span>
<span class="token punctuation">)</span>
</code></pre></div><h5 id="其他-捕获异常" tabindex="-1">其他--捕获异常 <a class="header-anchor" href="#其他-捕获异常" aria-hidden="true">#</a></h5><p>向开发人员邮箱发送(tranceback.format_exc())而不是(exception)</p><h2 id="缓存" tabindex="-1">缓存 <a class="header-anchor" href="#缓存" aria-hidden="true">#</a></h2><h3 id="缓存-1" tabindex="-1">缓存 <a class="header-anchor" href="#缓存-1" aria-hidden="true">#</a></h3><p>是一类可以更快的读取数据的介质统称，一般用来存储临时数据。</p><p>视图渲染有一定的成本，数据库频繁查询过高，所以对于<strong>低频变动的页面</strong>可以考虑使用缓存技术，减少实际渲染次数，用户拿到响应的时间成本会更低。</p><div class="language-python"><pre><code>given a URL<span class="token punctuation">,</span> <span class="token keyword">try</span> finding that page <span class="token keyword">in</span> the cache
<span class="token keyword">if</span> the page <span class="token keyword">is</span> <span class="token keyword">in</span> the cache<span class="token punctuation">:</span>
    <span class="token keyword">return</span> the cache page
<span class="token keyword">else</span><span class="token punctuation">:</span>
    generate the page
    save the generated page <span class="token keyword">in</span> the cache <span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token builtin">next</span> time<span class="token punctuation">)</span>
    <span class="token keyword">return</span> the generated age
</code></pre></div><h3 id="django中设置缓存-数据库缓存" tabindex="-1">Django中设置缓存-数据库缓存 <a class="header-anchor" href="#django中设置缓存-数据库缓存" aria-hidden="true">#</a></h3><p>将缓存的数据存储在您的数据库中</p><blockquote><p>尽管存储介质没有变化，但是当把一次负责查询的结果直接存储到表里面，比如多个条件的过滤查询结果，课避免进行复杂的查询，提升效率；</p></blockquote><div class="language-python"><pre><code>CACHES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;default&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;BACKEND&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;django.core.cache.backends.db.DatabaseCache&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;LOCATION&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;my_cache_table&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;TIMEOUT&#39;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment"># 缓存保存时间 单位秒，默认值为300</span>
        <span class="token string">&#39;OPTIONS&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;MAX_ENTRIES&#39;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment"># 缓存最大数据条数</span>
            <span class="token string">&#39;CULL_FREQUENCY&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment"># 缓存条数达到最大值时，删除1/x的缓存数据</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="django中设置缓存-本地内存缓存" tabindex="-1">Django中设置缓存-本地内存缓存 <a class="header-anchor" href="#django中设置缓存-本地内存缓存" aria-hidden="true">#</a></h3><p>数据缓存到服务器内存中</p><div class="language-python"><pre><code>CACHES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;default&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;BACKEND&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;django.core.cache.backends.locmem.LocMemCache&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;LOCATION&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;unique-snowflake&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>还有文件系统缓存等</p><p><a href="https://docs.djangoproject.com/zh-hans/3.2/topics/cache/" target="_blank" rel="noopener noreferrer">https://docs.djangoproject.com/zh-hans/3.2/topics/cache/</a></p><h3 id="django中使用缓存-视图函数中" tabindex="-1">Django中使用缓存-视图函数中 <a class="header-anchor" href="#django中使用缓存-视图函数中" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page

<span class="token decorator annotation punctuation">@cache_apge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>  <span class="token operator">-</span><span class="token operator">&gt;</span> 单位s
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><h3 id="django中使用缓存-路由中" tabindex="-1">Django中使用缓存-路由中 <a class="header-anchor" href="#django中使用缓存-路由中" aria-hidden="true">#</a></h3><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">&#39;foo/&#39;</span><span class="token punctuation">,</span> cache_page<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">(</span>my_view<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="缓存api的使用-局部缓存" tabindex="-1">缓存API的使用(局部缓存) <a class="header-anchor" href="#缓存api的使用-局部缓存" aria-hidden="true">#</a></h3><blockquote><p>上面的两个例子都是整体缓存，但灵活性低并且复用性差，是直接缓存的整个界面，而如果直接缓存sql结果的话就能解决这些问题</p></blockquote><h5 id="先引入cache对象" tabindex="-1">先引入cache对象 <a class="header-anchor" href="#先引入cache对象" aria-hidden="true">#</a></h5><ul><li><p>使用caches[&#39;<strong>CACHE配置key</strong>&#39;]导入具体对象</p><blockquote><p>这个就是配置中配置了多个配置项使用</p></blockquote><div class="language-python"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>care<span class="token punctuation">.</span>cache <span class="token keyword">import</span> caches

cache1 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">&#39;myalias&#39;</span><span class="token punctuation">]</span>
cacahe2 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">&#39;myalias_2&#39;</span><span class="token punctuation">]</span>
</code></pre></div></li><li><p>from django.core.cache import <strong>cache</strong> 相当于直接引入CACEHS配置项中的&#39;default&#39;项</p></li></ul><h5 id="使用-1" tabindex="-1">使用 <a class="header-anchor" href="#使用-1" aria-hidden="true">#</a></h5><div class="language-python"><pre><code>cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token comment"># 存储缓存</span>
<span class="token triple-quoted-string string">&#39;&#39;&#39;
key: 缓存的对象
value: python对象
timeout: 缓存存储时间(s),默认为CACHES中的TIMEOUT值
返回值None
&#39;&#39;&#39;</span>
</code></pre></div><div class="language-python"><pre><code>cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment"># 获取缓存(温柔地取)</span>
cache<span class="token punctuation">.</span>add<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment"># 存储缓存，仅在key不存在时生效</span>
</code></pre></div><p>其他方法：</p><div class="language-python"><pre><code>cache<span class="token punctuation">.</span>get_or_set<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token comment"># 如果未获取到数据，则执行set操作</span>
cache<span class="token punctuation">.</span>set_many<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token comment"># 批量存储缓存</span>
cache<span class="token punctuation">.</span>get_many<span class="token punctuation">(</span>key_list<span class="token punctuation">)</span>
cache<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
cache<span class="token punctuation">.</span>delete_many<span class="token punctuation">(</span>key_list<span class="token punctuation">)</span><span class="token number">2</span>
</code></pre></div><h3 id="浏览器缓存策略" tabindex="-1">浏览器缓存策略 <a class="header-anchor" href="#浏览器缓存策略" aria-hidden="true">#</a></h3><h5 id="强缓存" tabindex="-1">强缓存 <a class="header-anchor" href="#强缓存" aria-hidden="true">#</a></h5><blockquote><p>不会向服务器发送请求，直接从缓存中读取资源</p></blockquote><ul><li><p>响应头-Expires(绝对时间)</p><p>定义：缓存过期时间，用来指定资源到期的时间，是服务端的集体的时间点</p><p>样例：Expires:Thu,02 Apr 2030 05......</p></li><li><p>响应头-Cache-Control(相对时间)</p><p>在HTTP/1.1中，Cache-Control主要用于控制网页缓存。比如Cache-Control：max-age=120表示请求创建时间的120秒后缓存失效</p></li></ul><p>说明：目前服务器都会带着这两个头同时响应给浏览器，浏览器优先使用Cache-Control</p><h5 id="协商缓存" tabindex="-1">协商缓存 <a class="header-anchor" href="#协商缓存" aria-hidden="true">#</a></h5><p>强缓存中的数据一旦过期，还需要更服务器进行通信，从而获取最新数据</p><p>如果强缓存中的数据是一些静态文件、大图片等呢？</p><p>解答：考虑到大土拍你这类比较消耗贷款且不易变化的数据，强缓存时间到期后，浏览器会去跟服务器协商，当前缓存是否可用，如果可用，服务器不必返回数据，浏览器继续使用原来缓存的数据，如果文件不可用，则返回最新数据。</p><p>Last-Modified响应头和If-Modified-Since请求头</p><blockquote><p>协商缓存是在强缓存基础之下的，所以正常情况下，协商缓存回避强缓存多上面的这个头</p></blockquote><p>Last-Modified：文件的最近修改时间</p><p>If-Modified-Since：当缓存到期后，浏览器将获取到的Last-Modified值作为请求头If-Modified-Since的值，与服务器发请求协商，服务端返回304响应码【响应体为空】，代表缓存继续使用，200响应码代表缓存不可用【响应体为最新资源】</p><p>Etag响应头和If-None-Match请求头</p><blockquote><p>（现在一般用这个，这个算的是哈希来判断是否更改，上面那个是时间到秒：修改时间来判断）</p></blockquote><ul><li>Etag时服务器响应请求时，返回当前资源文件的一个唯一标识（有服务器生成），只要资源有变化，Etag就会重新生成；</li><li>缓存到期后，浏览器将Etag响应头的值做为If-None-Match请求头的值，给服务器发起请求协商；服务器街道请求头后，比对文件标识，不一致则认为资源不可用，返回200响应码【响应体为最新资源】；可用则返回304响应码</li></ul></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/知识库/后端储备/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>后端储备</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/知识库/后端储备/DRF学习笔记" data-v-38ede35f><span class="text" data-v-38ede35f>DRF学习笔记</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"1d8dde93\",\"推荐_typescript.md\":\"e40898d9\",\"推荐_index.md\":\"4ed1a4be\",\"推荐_动态规划.md\":\"11724621\",\"推荐_操作系统内存分配模拟程序.md\":\"e90f85be\",\"推荐_散列表实现查找.md\":\"6c0c112c\",\"推荐_这道题原来可以用到js这么多知识点！.md\":\"07db4206\",\"推荐_都2022年了，还是得学圣杯布局与双飞翼布局.md\":\"012f0078\",\"知识库_ai相关_tfidf计算的学习.md\":\"c9265030\",\"知识库_ai相关_index.md\":\"3a66f3b5\",\"知识库_css相关_01都2022年了，还是得学圣杯布局与双飞翼布局.md\":\"4d37581d\",\"知识库_css相关_index.md\":\"a71bbada\",\"知识库_javascript_typescript.md\":\"37a96a07\",\"知识库_javascript_index.md\":\"e7ebe10c\",\"知识库_javascript_这道题原来可以用到js这么多知识点！.md\":\"857449e5\",\"知识库_ui组件库_index.md\":\"2bd6def9\",\"知识库_index.md\":\"af41836f\",\"知识库_前端框架_01vue3是如何运行的.md\":\"969fdbb9\",\"知识库_前端框架_02vue3编译器.md\":\"fd46348e\",\"知识库_前端框架_03虚拟dom.md\":\"6ef7f095\",\"知识库_前端框架_04vue3-reactivity.md\":\"da98e3db\",\"知识库_前端框架_05mini-vue.md\":\"66aee536\",\"知识库_前端框架_06vue3其他.md\":\"3aaeab65\",\"知识库_前端框架_index.md\":\"7afb1c04\",\"知识库_后端储备_drf学习笔记.md\":\"96a743e3\",\"知识库_后端储备_django进阶学习笔记.md\":\"ea44ee8c\",\"知识库_后端储备_redis学习笔记.md\":\"9812981b\",\"知识库_后端储备_index.md\":\"28a806b0\",\"知识库_数据相关_index.md\":\"67502efc\",\"知识库_算法与数据结构_01基础概念.md\":\"5244ec12\",\"知识库_算法与数据结构_02线性表.md\":\"8a428a9c\",\"知识库_算法与数据结构_03栈和队列.md\":\"b0027a00\",\"知识库_算法与数据结构_04数组.md\":\"a1395525\",\"知识库_算法与数据结构_05树.md\":\"4a380226\",\"知识库_算法与数据结构_06图.md\":\"2a1ea4ea\",\"知识库_算法与数据结构_07查找.md\":\"4661eacb\",\"知识库_算法与数据结构_08排序.md\":\"9272c4cb\",\"知识库_算法与数据结构_09散列表实现查找.md\":\"1e4488fd\",\"知识库_算法与数据结构_10算法概述.md\":\"325360a3\",\"知识库_算法与数据结构_11递归与分治.md\":\"b6ab08ff\",\"知识库_算法与数据结构_12动态规划.md\":\"13832bb6\",\"知识库_算法与数据结构_13贪心算法.md\":\"07808a4e\",\"知识库_算法与数据结构_14回溯与分支界限.md\":\"7ee0c267\",\"知识库_算法与数据结构_index.md\":\"e2aa4fb8\",\"知识库_计算机基础知识_index.md\":\"c086ad1b\",\"知识库_计算机基础知识_操作系统内存分配模拟程序.md\":\"cd88e67f\",\"知识库_计算机基础知识_操作系统基础.md\":\"268c0b83\"}")</script>
    <script type="module" async src="/assets/app.0b1f5e83.js"></script>
    
  </body>
</html>