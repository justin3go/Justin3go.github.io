<!DOCTYPE html>
<html lang="zh-CH">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis学习笔记 | Justin3go's Blog-🖊</title>
    <meta name="description" content="我的技术博客，用心记录知识碎片，汇总整理程序员知识。">
    <link rel="stylesheet" href="/assets/style.8a11ac97.css">
    <link rel="modulepreload" href="/assets/Home.fc8ba9e3.js">
    <link rel="modulepreload" href="/assets/app.0b1f5e83.js">
    <link rel="modulepreload" href="/assets/知识库_后端储备_Redis学习笔记.md.334694e3.lean.js">
    
    <link rel="icon" href="/ava.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-alpha/dist/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
  <meta name="twitter:title" content="Redis学习笔记 | Justin3go&#39;s Blog-🖊">
  <meta property="og:title" content="Redis学习笔记 | Justin3go&#39;s Blog-🖊">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Justin3go&#39;s Blog-🖊, back to home" data-v-675d8756 data-v-cc01ef16><!----> Justin3go&#39;s Blog-🖊</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/知识库/" data-v-b8818f8c>知识库 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/推荐/" data-v-b8818f8c>站长推荐 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://space.bilibili.com/434542518" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>B站 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/Justin3go" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/知识库/" data-v-b8818f8c>知识库 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/推荐/" data-v-b8818f8c>站长推荐 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://space.bilibili.com/434542518" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>B站 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/Justin3go" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/">算法与数据结构</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/01基础概念">基础概念</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/02线性表">线性表</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/03栈和队列">栈和队列</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/04数组">数组</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/05树">树</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/06图">图</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/07查找">查找</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/08排序">排序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/09散列表实现查找">散列表实现查找</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/10算法概述">算法概述</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/11递归与分治">递归与分治</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/12动态规划">动态规划</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/13贪心算法">贪心算法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/算法与数据结构/14回溯与分支极限">回溯与分支极限</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/计算机基础知识/">计算机基础知识</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/计算机基础知识/操作系统基础">操作系统基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/计算机基础知识/操作系统内存分配模拟程序">操作系统内存分配模拟程序</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/JavaScript/">JavaScript</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/JavaScript/这道题原来可以用到JS这么多知识点！">这道题原来可以用到JS这么多知识点！</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/JavaScript/TypeScript">TypeScript</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/CSS相关/">CSS相关</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/CSS相关/01都2022年了，还是得学圣杯布局与双飞翼布局">圣杯布局与双飞翼布局</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/">前端框架</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/01Vue3是如何运行的">Vue3是如何运行的</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/02Vue3编译器">Vue3编译器</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/03虚拟DOM">虚拟DOM</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/04Vue3-Reactivity">Vue3-Reactivity</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/05Mini-Vue">Mini-Vue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/前端框架/06Vue3其他">Vue3其他</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/UI组件库/">UI组件库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/数据相关/">数据相关</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/后端储备/">后端储备</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/后端储备/Django进阶学习笔记">Django进阶学习笔记</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/后端储备/DRF学习笔记">DRF学习笔记</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/知识库/后端储备/Redis学习笔记">Redis学习笔记</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#redis-安装">Redis 安装</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置">配置</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#核心配置选项">核心配置选项</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#参考资料">参考资料</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#服务器端">服务器端</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#客户端">客户端</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#数据结构">数据结构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#数据操作行为">数据操作行为</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#string类型">string类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#保存">保存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#获取">获取</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#python交互">Python交互</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#string-增加">string-增加</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#string-获取">string-获取</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#string-修改">string-修改</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#string-删除">string-删除</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#获取键">获取键</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#主从">主从</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#主从配置">主从配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#数据操作">数据操作</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#集群">集群</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#集群的概念">集群的概念</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#redis集群">redis集群</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#搭建集群">搭建集群</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#参考阅读">参考阅读</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置机器1">配置机器1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置机器2">配置机器2</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#创建集群">创建集群</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#数据验证">数据验证</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#在哪个服务器上写数据：crc16">在哪个服务器上写数据：CRC16</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#python交互-1">Python交互</a><!----></li></ul></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/AI相关/">AI相关</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/知识库/AI相关/TFIDF计算的学习">TFIDF计算的学习</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="redis学习笔记" tabindex="-1">Redis学习笔记 <a class="header-anchor" href="#redis学习笔记" aria-hidden="true">#</a></h1><h2 id="redis-安装" tabindex="-1">Redis 安装 <a class="header-anchor" href="#redis-安装" aria-hidden="true">#</a></h2><ul><li><p>当前redis最新稳定版本是4.0.9</p></li><li><p>当前ubuntu虚拟机中已经安装好了redis，以下步骤可以跳过 最新稳定版本下载链接： <a href="http://download.redis.io/releases/redis-4.0.9.tar.gz" target="_blank" rel="noopener noreferrer">http://download.redis.io/releases/redis-4.0.9.tar.gz</a></p></li><li><p>step1:下载</p><blockquote><p>wget <a href="http://download.redis.io/releases/redis-4.0.9.tar.gz" target="_blank" rel="noopener noreferrer">http://download.redis.io/releases/redis-4.0.9.tar.gz</a></p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/%E4%B8%8B%E8%BD%BDredis.png" alt="img"></p></li><li><p>step2:解压</p><blockquote><p>tar xzf redis-4.0.9.tar.gz</p></blockquote></li><li><p>step3:移动，放到usr/local⽬录下</p><blockquote><p>sudo mv ./redis-4.0.9 /usr/local/redis/</p></blockquote></li><li><p>step4:进⼊redis⽬录</p><blockquote><p>cd /usr/local/redis/</p></blockquote></li><li><p>step5:生成</p><blockquote><p>sudo make</p></blockquote><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/redismake.png" alt="img" style="zoom:50%;"></li><li><p>step6:测试,这段运⾏时间会较⻓</p><blockquote><p>sudo make test</p></blockquote><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/maketest.png" alt="img" style="zoom:50%;"></li><li><p>step7:安装,将redis的命令安装到/usr/local/bin/⽬录</p><blockquote><p>sudo make install</p></blockquote></li><li><p>step8:安装完成后，我们进入目录/usr/local/bin中查看</p><blockquote><p>cd /usr/local/bin ls -all</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_12.png" alt="img"></p><blockquote><ul><li>redis-server redis服务器</li><li>redis-cli redis命令行客户端</li><li>redis-benchmark redis性能测试工具</li><li>redis-check-aof AOF文件修复工具</li><li>redis-check-rdb RDB文件检索工具</li></ul></blockquote></li><li><p>step9:配置⽂件，移动到/etc/⽬录下</p></li><li><p>配置⽂件⽬录为/usr/local/redis/redis.conf</p><blockquote><p>sudo cp /usr/local/redis/redis.conf /etc/redis/</p></blockquote></li><li><p>Mac 上安装 Redis:</p><ul><li>安装 Homebrew：</li></ul><blockquote><p><a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">https://brew.sh/</a></p></blockquote><ul><li>使用 brew 安装 Redis</li></ul><blockquote><p><a href="https://www.cnblogs.com/cloudshadow/p/mac_brew_install_redis.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/cloudshadow/p/mac_brew_install_redis.html</a></p></blockquote></li></ul><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-hidden="true">#</a></h2><ul><li><p>Redis的配置信息在/etc/redis/redis.conf下。</p></li><li><p>查看</p><blockquote><p>sudo vi /etc/redis/redis.conf</p></blockquote></li></ul><h3 id="核心配置选项" tabindex="-1">核心配置选项 <a class="header-anchor" href="#核心配置选项" aria-hidden="true">#</a></h3><ul><li><p>绑定ip：如果需要远程访问，可将此⾏注释，或绑定⼀个真实ip</p><blockquote><p>bind 127.0.0.1</p></blockquote></li><li><p>端⼝，默认为6379</p><blockquote><p>port 6379</p></blockquote></li><li><p>是否以守护进程运⾏</p><ul><li>如果以守护进程运⾏，则不会在命令⾏阻塞，类似于服务</li><li>如果以⾮守护进程运⾏，则当前终端被阻塞</li><li>设置为yes表示守护进程，设置为no表示⾮守护进程</li><li>推荐设置为yes</li></ul><blockquote><p>daemonize yes</p></blockquote></li><li><p>数据⽂件</p><blockquote><p>dbfilename dump.rdb</p></blockquote></li><li><p>数据⽂件存储路径</p><blockquote><p>dir /var/lib/redis</p></blockquote></li><li><p>⽇志⽂件</p><blockquote><p>logfile &quot;/var/log/redis/redis-server.log&quot;</p></blockquote></li><li><p>数据库，默认有16个</p><blockquote><p>database 16</p></blockquote></li><li><p>主从复制，类似于双机备份。</p><blockquote><p>slaveof</p></blockquote></li></ul><h3 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-hidden="true">#</a></h3><p>redis配置信息http://blog.csdn.net/ljphilp/article/details/52934933</p><h2 id="服务器端" tabindex="-1">服务器端 <a class="header-anchor" href="#服务器端" aria-hidden="true">#</a></h2><ul><li><p>服务器端的命令为redis-server</p></li><li><p>可以使⽤help查看帮助⽂档</p><blockquote><p>redis-server --help</p></blockquote></li><li><p>个人习惯</p><blockquote><p>ps aux | grep redis 查看redis服务器进程 sudo kill -9 pid 杀死redis服务器 sudo redis-server /etc/redis/redis.conf 指定加载的配置文件</p></blockquote></li></ul><h2 id="客户端" tabindex="-1">客户端 <a class="header-anchor" href="#客户端" aria-hidden="true">#</a></h2><ul><li><p>客户端的命令为redis-cli</p></li><li><p>可以使⽤help查看帮助⽂档</p><blockquote><p>redis-cli --help</p></blockquote></li><li><p>连接redis</p><blockquote><p>redis-cli</p></blockquote><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/%E8%BF%9E%E6%8E%A5redis.png" alt="img" style="zoom:50%;"></li><li><p>运⾏测试命令</p><blockquote><p>ping</p></blockquote><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/redis%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5.png" alt="img" style="zoom:50%;"></li><li><p>切换数据库</p></li><li><p>数据库没有名称，默认有16个，通过0-15来标识，连接redis默认选择第一个数据库</p><blockquote><p>select 10</p></blockquote><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/redis%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="img" style="zoom:50%;"></li></ul><h2 id="数据结构" tabindex="-1">数据结构 <a class="header-anchor" href="#数据结构" aria-hidden="true">#</a></h2><ul><li><p>redis是key-value的数据结构，每条数据都是⼀个键值对</p></li><li><p>键的类型是字符串</p></li><li><p>注意：键不能重复</p><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_67.png" alt="img"></p></li><li><p>值的类型分为五种：</p><ul><li>字符串string</li><li>哈希hash</li><li>列表list</li><li>集合set</li><li>有序集合zset</li></ul></li></ul><h2 id="数据操作行为" tabindex="-1">数据操作行为 <a class="header-anchor" href="#数据操作行为" aria-hidden="true">#</a></h2><ul><li>保存</li><li>修改</li><li>获取</li><li>删除</li></ul><h2 id="string类型" tabindex="-1">string类型 <a class="header-anchor" href="#string类型" aria-hidden="true">#</a></h2><ul><li>字符串类型是 Redis 中最为基础的数据存储类型，它在 Redis 中是二进制安全的，这便意味着该类型可以接受任何格式的数据，如JPEG图像数据或Json对象描述信息等。在Redis中字符串类型的Value最多可以容纳的数据长度是512M。</li></ul><h2 id="保存" tabindex="-1">保存 <a class="header-anchor" href="#保存" aria-hidden="true">#</a></h2><p>如果设置的键不存在则为添加，如果设置的键已经存在则修改</p><ul><li><p>设置键值</p><blockquote><p>set key value</p></blockquote></li><li><p>例1：设置键为name值为itcast的数据</p><blockquote><p>set name itcast</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_15.png" alt="img"></p></li><li><p>设置键值及过期时间，以秒为单位</p><blockquote><p>setex key seconds value</p></blockquote></li><li><p>例2：设置键为aa值为aa过期时间为3秒的数据</p><blockquote><p>setex aa 3 aa</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_16.png" alt="img"></p></li><li><p>设置多个键值</p><blockquote><p>mset key1 value1 key2 value2 ...</p></blockquote></li><li><p>例3：设置键为&#39;a1&#39;值为&#39;python&#39;、键为&#39;a2&#39;值为&#39;java&#39;、键为&#39;a3&#39;值为&#39;c&#39;</p><blockquote><p>mset a1 python a2 java a3 c</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_17.png" alt="img"></p></li><li><p>追加值</p><blockquote><p>append key value</p></blockquote></li><li><p>例4：向键为a1中追加值&#39; haha&#39;</p><blockquote><p>append &#39;a1&#39; &#39;haha&#39;</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_18.png" alt="img"></p><p><strong>......其他请自行搜索查看</strong></p></li></ul><h2 id="获取" tabindex="-1">获取 <a class="header-anchor" href="#获取" aria-hidden="true">#</a></h2><ul><li><p>获取：根据键获取值，如果不存在此键则返回nil</p><blockquote><p>get key</p></blockquote></li><li><p>例5：获取键&#39;name&#39;的值</p><blockquote><p>get &#39;name&#39;</p></blockquote></li><li><p>根据多个键获取多个值</p><blockquote><p>mget key1 key2 ...</p></blockquote></li><li><p>例6：获取键a1、a2、a3&#39;的值</p><blockquote><p>mget a1 a2 a3</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/mget.png" alt="img"></p></li></ul><h2 id="python交互" tabindex="-1">Python交互 <a class="header-anchor" href="#python交互" aria-hidden="true">#</a></h2><ul><li>在桌面上创建redis目录</li><li>使用pycharm打开 redis目录</li><li>创建redis_string.py文件</li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#创建StrictRedis对象，与redis服务器建⽴连接</span>
        sr<span class="token operator">=</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="string-增加" tabindex="-1">string-增加 <a class="header-anchor" href="#string-增加" aria-hidden="true">#</a></h3><ul><li>⽅法set，添加键、值，如果添加成功则返回True，如果添加失败则返回False</li><li>编写代码如下</li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#创建StrictRedis对象，与redis服务器建⽴连接</span>
        sr<span class="token operator">=</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#添加键name，值为itheima</span>
        result<span class="token operator">=</span>sr<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;itheima&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">#输出响应结果，如果添加成功则返回True，否则返回False</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="string-获取" tabindex="-1">string-获取 <a class="header-anchor" href="#string-获取" aria-hidden="true">#</a></h3><ul><li>⽅法get，添加键对应的值，如果键存在则返回对应的值，如果键不存在则返回None</li><li>编写代码如下</li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#创建StrictRedis对象，与redis服务器建⽴连接</span>
        sr<span class="token operator">=</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#获取键name的值</span>
        result <span class="token operator">=</span> sr<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">#输出键的值，如果键不存在则返回None</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="string-修改" tabindex="-1">string-修改 <a class="header-anchor" href="#string-修改" aria-hidden="true">#</a></h3><ul><li>⽅法set，如果键已经存在则进⾏修改，如果键不存在则进⾏添加</li><li>编写代码如下</li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#创建StrictRedis对象，与redis服务器建⽴连接</span>
        sr<span class="token operator">=</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#设置键name的值，如果键已经存在则进⾏修改，如果键不存在则进⾏添加</span>
        result <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;itcast&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">#输出响应结果，如果操作成功则返回True，否则返回False</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="string-删除" tabindex="-1">string-删除 <a class="header-anchor" href="#string-删除" aria-hidden="true">#</a></h3><ul><li>⽅法delete，删除键及对应的值，如果删除成功则返回受影响的键数，否则则返 回0</li><li>编写代码如下</li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#创建StrictRedis对象，与redis服务器建⽴连接</span>
        sr<span class="token operator">=</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#设置键name的值，如果键已经存在则进⾏修改，如果键不存在则进⾏添加</span>
        result <span class="token operator">=</span> sr<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">#输出响应结果，如果删除成功则返回受影响的键数，否则则返回0</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="获取键" tabindex="-1">获取键 <a class="header-anchor" href="#获取键" aria-hidden="true">#</a></h3><ul><li>⽅法keys，根据正则表达式获取键</li><li>编写代码如下</li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#创建StrictRedis对象，与redis服务器建⽴连接</span>
        sr<span class="token operator">=</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#获取所有的键</span>
        result<span class="token operator">=</span>sr<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#输出响应结果，所有的键构成⼀个列表，如果没有键则返回空列表</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="主从" tabindex="-1">主从 <a class="header-anchor" href="#主从" aria-hidden="true">#</a></h2><ul><li><p>⼀个master可以拥有多个slave，⼀个slave⼜可以拥有多个slave，如此下去，形成了强⼤的多级服务器集群架构</p></li><li><p>master用来写数据，slave用来读数据，经统计：网站的读写比率是10:1</p></li><li><p>通过主从配置可以实现读写分离</p><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_5.png" alt="img"></p></li><li><p>master和slave都是一个redis实例(redis服务)</p></li></ul><h3 id="主从配置" tabindex="-1">主从配置 <a class="header-anchor" href="#主从配置" aria-hidden="true">#</a></h3><h5 id="配置主" tabindex="-1">配置主 <a class="header-anchor" href="#配置主" aria-hidden="true">#</a></h5><ul><li><p>查看当前主机的ip地址</p><blockquote><p>ifconfig</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_10.png" alt="ifconfig"></p></li><li><p>修改etc/redis/redis.conf文件</p><blockquote><p>sudo vi redis.conf bind 192.168.26.128</p></blockquote></li><li><p>重启redis服务</p><blockquote><p>sudo service redis stop sudo redis-server redis.conf</p></blockquote></li></ul><h5 id="配置从" tabindex="-1">配置从 <a class="header-anchor" href="#配置从" aria-hidden="true">#</a></h5><ul><li><p>复制etc/redis/redis.conf文件</p><blockquote><p>sudo cp redis.conf ./slave.conf</p></blockquote></li><li><p>修改redis/slave.conf文件</p><blockquote><p>sudo vi slave.conf</p></blockquote></li><li><p>编辑内容</p><blockquote><p>bind 192.168.26.128 slaveof 192.168.26.128 6379 port 6378</p></blockquote></li><li><p>redis服务</p><blockquote><p>sudo redis-server slave.conf</p></blockquote></li><li><p>查看主从关系</p><blockquote><p>redis-cli -h 192.168.26.128 info Replication</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_9.png" alt="主从关系"></p></li></ul><h3 id="数据操作" tabindex="-1">数据操作 <a class="header-anchor" href="#数据操作" aria-hidden="true">#</a></h3><ul><li><p>在master和slave分别执⾏info命令，查看输出信息 进入主客户端</p><blockquote><p>redis-cli -h 192.168.26.128 -p 6379</p></blockquote></li><li><p>进入从的客户端</p><blockquote><p>redis-cli -h 192.168.26.128 -p 6378</p></blockquote></li><li><p>在master上写数据</p><blockquote><p>set aa aa</p></blockquote><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_56.png" alt="master写数据"></p></li><li><p>在slave上读数据</p><blockquote><p>get aa</p></blockquote></li></ul><h2 id="集群" tabindex="-1">集群 <a class="header-anchor" href="#集群" aria-hidden="true">#</a></h2><ul><li>之前我们已经讲了主从的概念，一主可以多从，如果同时的访问量过大(1000w),主服务肯定就会挂掉，数据服务就挂掉了或者发生自然灾难</li><li>大公司都会有很多的服务器(华东地区、华南地区、华中地区、华北地区、西北地区、西南地区、东北地区、台港澳地区机房)</li></ul><h3 id="集群的概念" tabindex="-1">集群的概念 <a class="header-anchor" href="#集群的概念" aria-hidden="true">#</a></h3><ul><li>集群是一组相互独立的、通过高速网络互联的计算机，它们构成了一个组，并以单一系统的模式加以管理。一个客户与集群相互作用时，集群像是一个独立的服务器。集群配置是用于提高可用性和可缩放性。 <img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_58.png" alt="集群"></li></ul><p>当请求到来首先由负载均衡服务器处理，把请求转发到另外的一台服务器上。</p><h3 id="redis集群" tabindex="-1">redis集群 <a class="header-anchor" href="#redis集群" aria-hidden="true">#</a></h3><ul><li>分类 <ul><li>软件层面</li><li>硬件层面</li></ul></li><li>软件层面：只有一台电脑，在这一台电脑上启动了多个redis服务。</li></ul><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_7.png" alt="软件层面"></p><ul><li>硬件层面：存在多台实体的电脑，每台电脑上都启动了一个redis或者多个redis服务。</li></ul><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_6.png" alt="硬件层面"></p><h3 id="搭建集群" tabindex="-1">搭建集群 <a class="header-anchor" href="#搭建集群" aria-hidden="true">#</a></h3><ul><li>当前拥有两台主机172.16.179.130、172.16.179.131，这⾥的IP在使⽤时要改为实际值</li></ul><h3 id="参考阅读" tabindex="-1">参考阅读 <a class="header-anchor" href="#参考阅读" aria-hidden="true">#</a></h3><ul><li>redis集群搭建 <a href="http://www.cnblogs.com/wuxl360/p/5920330.html" target="_blank" rel="noopener noreferrer">http://www.cnblogs.com/wuxl360/p/5920330.html</a></li><li>[Python]搭建redis集群 <a href="http://blog.5ibc.net/p/51020.html" target="_blank" rel="noopener noreferrer">http://blog.5ibc.net/p/51020.html</a></li></ul><h3 id="配置机器1" tabindex="-1">配置机器1 <a class="header-anchor" href="#配置机器1" aria-hidden="true">#</a></h3><ul><li><p>在演示中，172.16.179.130为当前ubuntu机器的ip</p></li><li><p>在172.16.179.130上进⼊Desktop⽬录，创建conf⽬录</p></li><li><p>在conf⽬录下创建⽂件7000.conf，编辑内容如下</p><div class="language-"><pre><code>port 7000
bind 172.16.179.130
daemonize yes
pidfile 7000.pid
cluster-enabled yes
cluster-config-file 7000_node.conf
cluster-node-timeout 15000
appendonly yes
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>在conf⽬录下创建⽂件7001.conf，编辑内容如下</p><div class="language-"><pre><code>port 7001
bind 172.16.179.130
daemonize yes
pidfile 7001.pid
cluster-enabled yes
cluster-config-file 7001_node.conf
cluster-node-timeout 15000
appendonly yes
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>在conf⽬录下创建⽂件7002.conf，编辑内容如下</p><div class="language-"><pre><code>port 7002
bind 172.16.179.130
daemonize yes
pidfile 7002.pid
cluster-enabled yes
cluster-config-file 7002_node.conf
cluster-node-timeout 15000
appendonly yes
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>总结：三个⽂件的配置区别在port、pidfile、cluster-config-file三项</p></li><li><p>使⽤配置⽂件启动redis服务</p><div class="language-"><pre><code>redis-server 7000.conf
redis-server 7001.conf
redis-server 7002.conf
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>查看进程如下图 <img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_59.png" alt="img"></p></li></ul><h3 id="配置机器2" tabindex="-1">配置机器2 <a class="header-anchor" href="#配置机器2" aria-hidden="true">#</a></h3><ul><li><p>在演示中，172.16.179.131为当前ubuntu机器的ip</p></li><li><p>在172.16.179.131上进⼊Desktop⽬录，创建conf⽬录</p></li><li><p>在conf⽬录下创建⽂件7003.conf，编辑内容如下</p><div class="language-"><pre><code>port 7003
bind 172.16.179.131
daemonize yes
pidfile 7003.pid
cluster-enabled yes
cluster-config-file 7003_node.conf
cluster-node-timeout 15000
appendonly yes
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>在conf⽬录下创建⽂件7004.conf，编辑内容如下</p><div class="language-"><pre><code>port 7004
bind 172.16.179.131
daemonize yes
pidfile 7004.pid
cluster-enabled yes
cluster-config-file 7004_node.conf
cluster-node-timeout 15000
appendonly yes
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>在conf⽬录下创建⽂件7005.conf，编辑内容如下</p><div class="language-"><pre><code>port 7005
bind 172.16.179.131
daemonize yes
pidfile 7005.pid
cluster-enabled yes
cluster-config-file 7005_node.conf
cluster-node-timeout 15000
appendonly yes
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>总结：三个⽂件的配置区别在port、pidfile、cluster-config-file三项</p></li><li><p>使⽤配置⽂件启动redis服务</p><div class="language-"><pre><code>redis-server 7003.conf
redis-server 7004.conf
redis-server 7005.conf
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>查看进程如下图 <img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_60.png" alt="进程"></p></li></ul><h3 id="创建集群" tabindex="-1">创建集群 <a class="header-anchor" href="#创建集群" aria-hidden="true">#</a></h3><ul><li><p>redis的安装包中包含了redis-trib.rb，⽤于创建集群</p></li><li><p>接下来的操作在172.16.179.130机器上进⾏</p></li><li><p>将命令复制，这样可以在任何⽬录下调⽤此命令</p><div class="language-"><pre><code>sudo cp /usr/share/doc/redis-tools/examples/redis-trib.rb /usr/local/bin/
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>安装ruby环境，因为redis-trib.rb是⽤ruby开发的</p><blockquote><p>sudo apt-get install ruby</p></blockquote></li><li><p>在提示信息处输⼊y，然后回⻋继续安装 <img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_61.png" alt="安装"></p></li><li><p>运⾏如下命令创建集群</p><div class="language-"><pre><code>redis-trib.rb create --replicas 1 172.16.179.130:7000 172.16.179.130:7001 172.16.179.130:7002 172.16.179.131:7003 172.16.179.131:7004 172.16.179.131:7005
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>执⾏上⾯这个指令在某些机器上可能会报错,主要原因是由于安装的 ruby 不是最 新版本!</p></li><li><p>天朝的防⽕墙导致⽆法下载最新版本,所以需要设置 gem 的源</p></li><li><p>解决办法如下</p><div class="language-"><pre><code>-- 先查看⾃⼰的 gem 源是什么地址
gem source -l -- 如果是https://rubygems.org/ 就需要更换
-- 更换指令为
gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/
-- 通过 gem 安装 redis 的相关依赖
sudo gem install redis
-- 然后重新执⾏指令
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_64.png" alt="安装"></p><div class="language-"><pre><code>redis-trib.rb create --replicas 1 172.16.179.130:7000 172.16.179.130:7001 172.16.179.130:7002 172.16.179.131:7003 172.16.179.131:7004 172.16.179.131:7005
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>提示如下主从信息，输⼊yes后回⻋ <img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_62.png" alt="主从"></p></li><li><p>提示完成，集群搭建成功</p></li></ul><h3 id="数据验证" tabindex="-1">数据验证 <a class="header-anchor" href="#数据验证" aria-hidden="true">#</a></h3><ul><li><p>根据上图可以看出，当前搭建的主服务器为7000、7001、7003，对应的从服务器是7004、7005、7002</p></li><li><p>在172.16.179.131机器上连接7002，加参数-c表示连接到集群</p><blockquote><p>redis-cli -h 172.16.179.131 -c -p 7002</p></blockquote></li><li><p>写⼊数据</p><blockquote><p>set name itheima</p></blockquote></li><li><p>⾃动跳到了7003服务器，并写⼊数据成功</p></li><li><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_65.png" alt=""></p></li><li><p>在7003可以获取数据，如果写入数据又重定向到7000(负载均衡)</p></li><li><p><img src="https://webplus-cn-shenzhen-s-6130b804f968dd14cecc43e2.oss-cn-shenzhen.aliyuncs.com/blogs/p1_66.png" alt="p1_66"></p></li></ul><h3 id="在哪个服务器上写数据：crc16" tabindex="-1">在哪个服务器上写数据：CRC16 <a class="header-anchor" href="#在哪个服务器上写数据：crc16" aria-hidden="true">#</a></h3><ul><li>redis cluster在设计的时候，就考虑到了去中⼼化，去中间件，也就是说，集群中 的每个节点都是平等的关系，都是对等的，每个节点都保存各⾃的数据和整个集 群的状态。每个节点都和其他所有节点连接，⽽且这些连接保持活跃，这样就保 证了我们只需要连接集群中的任意⼀个节点，就可以获取到其他节点的数据</li><li>Redis集群没有并使⽤传统的⼀致性哈希来分配数据，⽽是采⽤另外⼀种叫做哈希 槽 (hash slot)的⽅式来分配的。redis cluster 默认分配了 16384 个slot，当我们 set⼀个key 时，会⽤CRC16算法来取模得到所属的slot，然后将这个key 分到哈 希槽区间的节点上，具体算法就是：CRC16(key) % 16384。所以我们在测试的 时候看到set 和 get 的时候，直接跳转到了7000端⼝的节点</li><li>Redis 集群会把数据存在⼀个 master 节点，然后在这个 master 和其对应的salve 之间进⾏数据同步。当读取数据时，也根据⼀致性哈希算法到对应的 master 节 点获取数据。只有当⼀个master 挂掉之后，才会启动⼀个对应的 salve 节点，充 当 master</li><li>需要注意的是：必须要3个或以上的主节点，否则在创建集群时会失败，并且当存 活的主节点数⼩于总节点数的⼀半时，整个集群就⽆法提供服务了</li></ul><h3 id="python交互-1" tabindex="-1">Python交互 <a class="header-anchor" href="#python交互-1" aria-hidden="true">#</a></h3><ul><li><p>安装包如下</p><blockquote><p>pip install redis-py-cluster</p></blockquote></li><li><p>redis-py-cluster源码地址https://github.com/Grokzen/redis-py-cluster</p></li><li><p>创建⽂件redis_cluster.py，示例码如下</p></li></ul><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> rediscluster <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
  <span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 构建所有的节点，Redis会使⽤CRC16算法，将键和值写到某个节点上</span>
    startup_nodes <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;192.168.26.128&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;7000&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;192.168.26.130&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;7003&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;192.168.26.128&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;7001&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token comment"># 构建RedisCluster对象</span>
    src<span class="token operator">=</span>RedisCluster<span class="token punctuation">(</span>startup_nodes<span class="token operator">=</span>startup_nodes<span class="token punctuation">,</span>decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置键为name、值为itheima的数据</span>
    result<span class="token operator">=</span>src<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;itheima&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token comment"># 获取键为name</span>
    name <span class="token operator">=</span> src<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/知识库/后端储备/DRF学习笔记" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>DRF学习笔记</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/知识库/AI相关/" data-v-38ede35f><span class="text" data-v-38ede35f>AI相关</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"1d8dde93\",\"推荐_typescript.md\":\"d36b7b6a\",\"推荐_index.md\":\"abe76e33\",\"推荐_动态规划.md\":\"33e80a41\",\"推荐_散列表实现查找.md\":\"f756d3a5\",\"推荐_这道题原来可以用到js这么多知识点！.md\":\"bb5622f7\",\"推荐_都2022年了，还是得学圣杯布局与双飞翼布局.md\":\"90aaf8d1\",\"知识库_ai相关_tfidf计算的学习.md\":\"9590ff26\",\"知识库_ai相关_index.md\":\"3a66f3b5\",\"知识库_css相关_01都2022年了，还是得学圣杯布局与双飞翼布局.md\":\"464d08ca\",\"知识库_css相关_index.md\":\"a71bbada\",\"知识库_javascript_typescript.md\":\"b850d80a\",\"知识库_javascript_index.md\":\"e7ebe10c\",\"知识库_javascript_这道题原来可以用到js这么多知识点！.md\":\"249bf872\",\"知识库_ui组件库_index.md\":\"2bd6def9\",\"知识库_index.md\":\"af41836f\",\"知识库_前端框架_01vue3是如何运行的.md\":\"86cec4bb\",\"知识库_前端框架_02vue3编译器.md\":\"52e2bec2\",\"知识库_前端框架_03虚拟dom.md\":\"d224500e\",\"知识库_前端框架_04vue3-reactivity.md\":\"2649160c\",\"知识库_前端框架_05mini-vue.md\":\"3dfde9a0\",\"知识库_前端框架_06vue3其他.md\":\"4f2a3b66\",\"知识库_前端框架_index.md\":\"7afb1c04\",\"知识库_后端储备_drf学习笔记.md\":\"e5ebedbe\",\"知识库_后端储备_django进阶学习笔记.md\":\"89b929ac\",\"知识库_后端储备_redis学习笔记.md\":\"334694e3\",\"知识库_后端储备_index.md\":\"28a806b0\",\"知识库_数据相关_index.md\":\"67502efc\",\"知识库_算法与数据结构_01基础概念.md\":\"bbe4a723\",\"知识库_算法与数据结构_02线性表.md\":\"f9ba94a1\",\"知识库_算法与数据结构_03栈和队列.md\":\"8a0df086\",\"知识库_算法与数据结构_04数组.md\":\"a2a46c9f\",\"知识库_算法与数据结构_05树.md\":\"ab698d4d\",\"知识库_算法与数据结构_06图.md\":\"c28a2e10\",\"知识库_算法与数据结构_07查找.md\":\"4661eacb\",\"知识库_算法与数据结构_08排序.md\":\"a54d9537\",\"知识库_算法与数据结构_09散列表实现查找.md\":\"4af489c6\",\"知识库_算法与数据结构_10算法概述.md\":\"b0471211\",\"知识库_算法与数据结构_11递归与分治.md\":\"59726a7a\",\"知识库_算法与数据结构_12动态规划.md\":\"ec279dea\",\"知识库_算法与数据结构_13贪心算法.md\":\"2b41f907\",\"知识库_算法与数据结构_14回溯与分支界限.md\":\"4ca2577e\",\"知识库_算法与数据结构_index.md\":\"e2aa4fb8\",\"知识库_计算机基础知识_index.md\":\"c086ad1b\",\"知识库_计算机基础知识_操作系统内存分配模拟程序.md\":\"a3857a9a\",\"知识库_计算机基础知识_操作系统基础.md\":\"268c0b83\"}")</script>
    <script type="module" async src="/assets/app.0b1f5e83.js"></script>
    
  </body>
</html>