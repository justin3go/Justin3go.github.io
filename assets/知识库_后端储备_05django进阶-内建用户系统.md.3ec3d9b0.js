import{_ as n,c as s,o as a,a as e}from"./app.f0844215.js";const b='{"title":"\u81EA\u5B9A\u4E49\u6269\u5C55\u5B57\u6BB5\u7684\u65B9\u6CD5","description":"","frontmatter":{},"headers":[],"relativePath":"\u77E5\u8BC6\u5E93/\u540E\u7AEF\u50A8\u5907/05django\u8FDB\u9636-\u5185\u5EFA\u7528\u6237\u7CFB\u7EDF.md","lastUpdated":1635078923212}',p={},t=e(`<h4 id="\u81EA\u5B9A\u4E49\u6269\u5C55\u5B57\u6BB5\u7684\u65B9\u6CD5" tabindex="-1">\u81EA\u5B9A\u4E49\u6269\u5C55\u5B57\u6BB5\u7684\u65B9\u6CD5 <a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u6269\u5C55\u5B57\u6BB5\u7684\u65B9\u6CD5" aria-hidden="true">#</a></h4><ul><li><p>\u5EFA\u7ACB\u4E00\u4E2A\u4E00\u5BF9\u4E00\u7684\u8868\u6269\u5C55User\u6A21\u578B</p><p>\u4EE5\u540E\u53D6\u5B57\u6BB5\u9700\u8981\u67E5\u8BE2</p><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    department <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>\u7EE7\u627FAbstracUser\u7C7B\u66FF\u6362User\u6A21\u578B</p><p>\u4ECD\u7136\u53EF\u4EE5\u4F7F\u7528django\u4E00\u5957\u7684\u7528\u6237\u64CD\u4F5C</p><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6CE8\u610F\uFF1A\u9700\u8981\u5728\u914D\u7F6E\u6587\u4EF6\u6307\u5B9A\u4F7F\u7528\u81EA\u5DF1\u7684\u7528\u6237\u7C7B</p><div class="language-python line-numbers-mode"><pre><code>AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">&#39;myapp.MyUser&#39;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>django\u5EFA\u8BAE\u5728\u9879\u76EE\u521D\u671F\u4F7F\u7528\u66FF\u6362\uFF0C\u9879\u76EE\u4E2D\u671F\u4F7F\u7528\u4E00\u5BF9\u4E00</p></li><li><p>\u6B64\u65F6\u5F15\u7528User\u5C31\u5E94\u8BE5\u4F7F\u7528\u4F60\u81EA\u5B9A\u4E49\u7684User\u540D\u6216\u8005\u4F7F\u7528get_user_model()\u65B9\u6CD5</p></li></ul><h4 id="\u9ED8\u8BA4\u7528\u6237\u7684\u5B57\u6BB5" tabindex="-1">\u9ED8\u8BA4\u7528\u6237\u7684\u5B57\u6BB5 <a class="header-anchor" href="#\u9ED8\u8BA4\u7528\u6237\u7684\u5B57\u6BB5" aria-hidden="true">#</a></h4><ul><li>username</li><li>password</li><li>email</li><li>first_name</li><li>last_name</li></ul><h4 id="\u521B\u5EFA\u7528\u6237" tabindex="-1">\u521B\u5EFA\u7528\u6237 <a class="header-anchor" href="#\u521B\u5EFA\u7528\u6237" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span><span class="token string">&#39;john&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;lennon@thebeatles.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;johnpassword&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># At this point, user is a User object that has already been saved</span>
<span class="token comment"># to the database. You can continue to change its attributes</span>
<span class="token comment"># if you want to change other fields.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>last_name <span class="token operator">=</span> <span class="token string">&#39;Lennon&#39;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="\u66F4\u6539\u5BC6\u7801" tabindex="-1">\u66F4\u6539\u5BC6\u7801 <a class="header-anchor" href="#\u66F4\u6539\u5BC6\u7801" aria-hidden="true">#</a></h4><p>set_password()</p><blockquote><p>\u6CE8\u610F\u4E0D\u80FD\u76F4\u63A5\u66F4\u65B0\u6570\u636E\u5E93\u4E2D\u7684\u5BC6\u7801\uFF0C\u56E0\u4E3A\u90A3\u662F\u975E\u660E\u6587\u64CD\u4F5C\u7684</p></blockquote><div class="language-python line-numbers-mode"><pre><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;john&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span><span class="token string">&#39;new password&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="\u9A8C\u8BC1\u7528\u6237" tabindex="-1">\u9A8C\u8BC1\u7528\u6237 <a class="header-anchor" href="#\u9A8C\u8BC1\u7528\u6237" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate
user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;john&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;secret&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token comment"># A backend authenticated the credentials</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># No backend authenticated the credentials</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u4F7F\u7528 authenticate() \u6765\u9A8C\u8BC1\u7528\u6237\u3002\u5B83\u4F7F\u7528 username \u548C password \u4F5C\u4E3A\u53C2\u6570\u6765\u9A8C\u8BC1\uFF0C\u5BF9\u6BCF\u4E2A\u8EAB\u4EFD\u9A8C\u8BC1\u540E\u7AEF( authentication backend )\u8FDB\u884C\u68C0\u67E5\u3002\u5982\u679C\u540E\u7AEF\u9A8C\u8BC1\u6709\u6548\uFF0C\u5219\u8FD4\u56DE\u4E00\u4E2A :class:\`~django.contrib.auth.models.User \u5BF9\u8C61\u3002\u5982\u679C\u540E\u7AEF\u5F15\u53D1 PermissionDenied \u9519\u8BEF\uFF0C\u5C06\u8FD4\u56DE None</p><h4 id="\u767B\u5F55" tabindex="-1">\u767B\u5F55 <a class="header-anchor" href="#\u767B\u5F55" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate<span class="token punctuation">,</span> login

<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">]</span>
    user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>request<span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span>
    <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        login<span class="token punctuation">(</span>request<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token comment"># Redirect to a success page.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Return an &#39;invalid login&#39; error message.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="\u767B\u51FA" tabindex="-1">\u767B\u51FA <a class="header-anchor" href="#\u767B\u51FA" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> logout

<span class="token keyword">def</span> <span class="token function">logout_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token comment"># Redirect to a success page.</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="\u9650\u5236\u5BF9\u672A\u767B\u5F55\u7528\u6237\u7684\u8BBF\u95EE" tabindex="-1">\u9650\u5236\u5BF9\u672A\u767B\u5F55\u7528\u6237\u7684\u8BBF\u95EE <a class="header-anchor" href="#\u9650\u5236\u5BF9\u672A\u767B\u5F55\u7528\u6237\u7684\u8BBF\u95EE" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect

<span class="token comment"># \u8FD9\u91CC\u5E08\u662F\u91CD\u5B9A\u5411\u5230\u767B\u5F55\u754C\u9762\uFF0C\u5E76\u4E14next\u4FDD\u7559\u4E0A\u4E00\u4E2A\u754C\u9762\u7684\u4FE1\u606F\uFF0C\u65B9\u4FBF\u767B\u5F55\u540E\u56DE\u5230\u4E4B\u524D\u7684\u754C\u9762</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;%s?next=%s&#39;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>settings<span class="token punctuation">.</span>LOGIN_URL<span class="token punctuation">,</span> request<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># ...</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="login-required-\u88C5\u9970\u5668" tabindex="-1">login_required \u88C5\u9970\u5668 <a class="header-anchor" href="#login-required-\u88C5\u9970\u5668" aria-hidden="true">#</a></h4><p>\u4F5C\u7528\uFF1A</p><ul><li>\u5982\u679C\u7528\u6237\u6CA1\u6709\u767B\u5F55\uFF0C\u4F1A\u91CD\u5B9A\u5411\u5230setting.LOGIN_URL\u4E2D\uFF0C\u5E76\u4F20\u9012\u7EDD\u5BF9\u8DEF\u5F84\u5230\u67E5\u8BE2\u5B57\u7B26\u4E32\u4E2D</li><li>\u6216\u8005\u76F4\u63A5\u5199url\uFF1A@login_required(login_url=&#39;/accounts/login/&#39;)</li></ul><h4 id="\u9650\u5236\u5BF9\u901A\u8FC7\u6D4B\u8BD5\u7684\u767B\u5F55\u7528\u6237\u7684\u8BBF\u95EE" tabindex="-1">\u9650\u5236\u5BF9\u901A\u8FC7\u6D4B\u8BD5\u7684\u767B\u5F55\u7528\u6237\u7684\u8BBF\u95EE <a class="header-anchor" href="#\u9650\u5236\u5BF9\u901A\u8FC7\u6D4B\u8BD5\u7684\u767B\u5F55\u7528\u6237\u7684\u8BBF\u95EE" aria-hidden="true">#</a></h4><p>\u4F60\u53EF\u4EE5\u65B9\u4FBF\u7684\u8C03\u7528 <code>user_passes_test</code> \u88C5\u9970\u5668\uFF0C\u5F53\u8C03\u7528\u8FD4\u56DE <code>False</code> \u65F6\u4F1A\u6267\u884C\u91CD\u5B9A\u5411\u3002</p><blockquote><p>user_passes_test(test_func, login_url=None, redirect_field_name=&#39;next&#39;)</p><p>redirect_field_name: \u4E0E login_required() \u76F8\u540C\u3002\u5982\u679C\u4F60\u60F3\u628A\u6CA1\u901A\u8FC7\u68C0\u67E5\u7684\u7528\u6237\u91CD\u5B9A\u5411\u5230\u6CA1\u6709 &quot;next page&quot; \u7684\u975E\u767B\u5F55\u9875\u9762\u65F6\uFF0C\u628A\u5B83\u8BBE\u7F6E\u4E3A None \uFF0C\u8FD9\u6837\u5B83\u4F1A\u5728 URL \u4E2D\u79FB\u9664\u3002</p></blockquote><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> user_passes_test

<span class="token keyword">def</span> <span class="token function">email_check</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> user<span class="token punctuation">.</span>email<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">&#39;@example.com&#39;</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@user_passes_test</span><span class="token punctuation">(</span>email_check<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u7C7B\u7684\u8BDD\u7EE7\u627F<strong>UserPassesTestMixin</strong> # \u5176\u4ED6\u7684\u88C5\u9970\u5668\u90FD\u6709\u5BF9\u5E94\u7684MIXIN\u7C7B\uFF0C\u53EF\u67E5\u9605\u6587\u6863</p><h4 id="permission-required-\u88C5\u9970\u5668" tabindex="-1">permission_required \u88C5\u9970\u5668 <a class="header-anchor" href="#permission-required-\u88C5\u9970\u5668" aria-hidden="true">#</a></h4><p>permission_required(perm, login_url=None, raise_exception=False)</p><p>permission_required() \u4E5F\u53EF\u4EE5\u63A5\u53D7\u53EF\u9009\u7684 login_url \u53C2\u6570\u2014\u2014\u2014\u2014\u2014\u2014\u53BB\u770B\u6587\u6863</p>`,30),o=[t];function c(r,l,u,i,k,d){return a(),s("div",null,o)}var h=n(p,[["render",c]]);export{b as __pageData,h as default};
